<!DOCTYPE html>
<html lang="en">
<head>
</head>
<meta charset="utf8">
<body>
<center>
    <form action="/user/login" method="post">
        用户登录
        <table border="1">
            <tr>
                <td>用户帐号:</td>
                <td><input type="text" name="username"></td>
            </tr>
            <tr>
                <td>用户密码:</td>
                <td><input type="password" name="password"></td>
            </tr>
            <tr>
                <td>用户身份:</td>
                <td><input type="radio" name="checkbox1" id="checkbox1" value="value1"/>用户
                    <input type="radio" name="checkbox1" value="value2"/>管理员
                </td>
            </tr>

            <tr>
                <td colspan="2"><input value="登录" type="button" onclick="userLogin()"> <input
                        type="reset" value="重置"></td>
            </tr>
        </table>
      <!-- <a href="/regist">点我注册！！</a>-->
    </form>

</center>
<script>
    function userLogin() {
        let username = $("input[name='username']").val();
        let password = $("input[name='password']").val();
        let radio = $('input:radio:checked').val();
        let flag;
        if (radio === "value2")
            flag = 0;
        else
            flag = 1;
        $.ajax({
            url: "/userDemo/login",
            type: "post",
            data: JSON.stringify({
                flag: flag,
                user: {
                    'username': username,
                    'password': password
                }
            }),
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            cache: false,
            async: true,
            success: function (data) {
                let result = JSON.stringify(data);
                //  console.log(result)//将json对象转化成字符串打印看一下
                //这里判断跳转就好了
                let LoginSuccess = data.flag;
                if (LoginSuccess === true) {
                    if (flag === 1) {
                        let roleId = data.data.roleId;
                        if (roleId === 0)
                            location.href = "/customer";
                        else
                            location.href = "/purchaser";
                    } else
                        location.href = "/admin";
                } else
                    alert("登录失败！")
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert("服务器错误！");
            }
        });
    }

</script>
<script>
    function getCookie(name) {
        var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
        if (arr = document.cookie.match(reg))
            return unescape(arr[2]);
        else
            return null;
    }
    window.onload = function () {
        //获取cookies   并用冒号分割
        if (getCookie("loginUserInfo") != null && getCookie("loginUserInfo") != "") {
            var loginUserInfo = getCookie("loginUserInfo").split(":");
            var data = JSON.stringify(loginUserInfo);
            if (data != '[""]') {
                $("input[name='username']").val(loginUserInfo[0]);
                $("input[name='password']").val(loginUserInfo[1]);
                //默认选中用户
                $("input[id='checkbox1").prop("checked", true);
                //$("input[id='rememberMe']:checked").attr("checked",true);//这个选中值 但页面不会改变
                //$("input[type='checkbox']").prop({checked: true});//这个选中值 但页面不会改变
            }

        }
    }
</script>
<script src="../static/js/jquery.1.12.4.min.js"></script>
</body>
</html>